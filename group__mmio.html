<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>devLib2: Memory Mapped I/O</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">devLib2
   &#160;<span id="projectnumber">2.11</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Memory Mapped I/O</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="memitem:ga6c439c03ce1627a9b7347732c9fa1c89"><td class="memItemLeft" align="right" valign="top">INLINE epicsUInt8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mmio.html#ga6c439c03ce1627a9b7347732c9fa1c89">ioread8</a> (volatile void *addr)</td></tr>
<tr class="memdesc:ga6c439c03ce1627a9b7347732c9fa1c89"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read a single byte.  <a href="#ga6c439c03ce1627a9b7347732c9fa1c89">More...</a><br /></td></tr>
<tr class="separator:ga6c439c03ce1627a9b7347732c9fa1c89"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7a98b2fb893898ff2591d3192358f261"><td class="memItemLeft" align="right" valign="top">INLINE epicsUInt16&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mmio.html#ga7a98b2fb893898ff2591d3192358f261">bswap16</a> (epicsUInt16 value)</td></tr>
<tr class="separator:ga7a98b2fb893898ff2591d3192358f261"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabbb2bfa242f7b667710cd2adb6d8ffad"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mmio.html#gabbb2bfa242f7b667710cd2adb6d8ffad">rbarr</a>()&#160;&#160;&#160;do{}while(0)</td></tr>
<tr class="memdesc:gabbb2bfa242f7b667710cd2adb6d8ffad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Explicit read memory barrier Prevents reordering of reads around it.  <a href="#gabbb2bfa242f7b667710cd2adb6d8ffad">More...</a><br /></td></tr>
<tr class="separator:gabbb2bfa242f7b667710cd2adb6d8ffad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga18dc5c35a3413bd02ca26bc181a45141"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mmio.html#ga18dc5c35a3413bd02ca26bc181a45141">wbarr</a>()&#160;&#160;&#160;do{}while(0)</td></tr>
<tr class="memdesc:ga18dc5c35a3413bd02ca26bc181a45141"><td class="mdescLeft">&#160;</td><td class="mdescRight">Explicit write memory barrier Prevents reordering of writes around it.  <a href="#ga18dc5c35a3413bd02ca26bc181a45141">More...</a><br /></td></tr>
<tr class="separator:ga18dc5c35a3413bd02ca26bc181a45141"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaed3ff8d20a3a9671dc75919dcc08a21f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mmio.html#gaed3ff8d20a3a9671dc75919dcc08a21f">rwbarr</a>()&#160;&#160;&#160;do{}while(0)</td></tr>
<tr class="memdesc:gaed3ff8d20a3a9671dc75919dcc08a21f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Explicit read/write memory barrier Prevents reordering of reads or writes around it.  <a href="#gaed3ff8d20a3a9671dc75919dcc08a21f">More...</a><br /></td></tr>
<tr class="separator:gaed3ff8d20a3a9671dc75919dcc08a21f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Safe operations on I/O memory.</p>
<p>This files defines a set of macros for access to Memory Mapped I/O</p>
<p>They are named T_ioread# and T_iowrite# where # can be 8, 16, or 32. 'T' can either be 'le', 'be', or 'nat' (except ioread8 and iowrite8).</p>
<p>The macros defined use OS specific extensions (when available) to ensure the following.</p>
<ul>
<li>Width. A 16 bit operation will not be broken into two 8 bit operations, or one half of a 32 bit operation.</li>
</ul>
<ul>
<li>Order. Writes to two different registers will not be reordered. This only applies to MMIO operations, not between MMIO and normal memory operations.</li>
</ul>
<p>PCI access should use either 'le_' or 'be_' as determined by the device byte order.</p>
<p>VME access should always use 'nat_'. If the device byte order is little endian then an explicit swap is required.</p>
<h1><a class="anchor" id="mmioex"></a>
Examples:</h1>
<h2><a class="anchor" id="mmioexbe"></a>
Big endian device:</h2>
<p><b>PCI</b> </p>
<div class="fragment"><div class="line"><a class="code" href="epics_m_m_i_o_def_8h.html#a53fa7c1334c3dd55c18ff39d539c7967">be_iowrite16</a>(base+off, 14);</div><div class="line">var = <a class="code" href="epics_m_m_i_o_def_8h.html#a0d46f3f1cfa66ab45435648f183b1701">be_ioread16</a>(base+off);</div></div><!-- fragment --><p><b>VME</b> </p>
<div class="fragment"><div class="line"><a class="code" href="epics_m_m_i_o_def_8h.html#ae71c1ec8689d91d6e9a4ddb701f950a1">nat_iowrite16</a>(base+off, 14);</div><div class="line">var = <a class="code" href="epics_m_m_i_o_def_8h.html#af4ed3c8ce9451b59b2bbebeb7d059165">nat_ioread16</a>(base+off);</div></div><!-- fragment --><h2><a class="anchor" id="mmioexle"></a>
Little endian device</h2>
<p><b>PCI</b> </p><div class="fragment"><div class="line"><a class="code" href="epics_m_m_i_o_def_8h.html#ac52c3a503c557e71b049d344c3f7d97b">le_iowrite16</a>(base+off, 14);</div><div class="line">var = <a class="code" href="epics_m_m_i_o_def_8h.html#a3071e41ab96b7735ed63540c5c016765">le_ioread16</a>(base+off);</div></div><!-- fragment --><p> <b>VME</b> </p><div class="fragment"><div class="line"><a class="code" href="epics_m_m_i_o_def_8h.html#ae71c1ec8689d91d6e9a4ddb701f950a1">nat_iowrite16</a>(base+off, <a class="code" href="group__mmio.html#ga7a98b2fb893898ff2591d3192358f261">bswap16</a>(14));</div><div class="line">var = <a class="code" href="group__mmio.html#ga7a98b2fb893898ff2591d3192358f261">bswap16</a>(<a class="code" href="epics_m_m_i_o_def_8h.html#ae71c1ec8689d91d6e9a4ddb701f950a1">nat_iowrite16</a>(base+off));</div></div><!-- fragment --><p> This difference arises because VME bridges implement hardware byte swapping on little endian systems, while PCI bridges do not. Software accessing PCI devices must know if byte swapping is required. This conditional swap is implemented by the 'be_' and 'le_' macros.</p>
<p>This is a fundamental difference between PCI and VME.</p>
<p>Software accessing PCI <b>must</b> do conditional swapping.</p>
<p>Software accessing VME must <b>not</b> do conditional swapping.</p>
<dl class="section note"><dt>Note</dt><dd>All read and write operations have an implicit read or write barrier. </dd></dl>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="gabbb2bfa242f7b667710cd2adb6d8ffad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gabbb2bfa242f7b667710cd2adb6d8ffad">&#9670;&nbsp;</a></span>rbarr</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define rbarr</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td>&#160;&#160;&#160;do{}while(0)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Explicit read memory barrier Prevents reordering of reads around it. </p>

<p class="definition">Definition at line <a class="el" href="epics_m_m_i_o_def_8h_source.html#l00194">194</a> of file <a class="el" href="epics_m_m_i_o_def_8h_source.html">epicsMMIODef.h</a>.</p>

</div>
</div>
<a id="gaed3ff8d20a3a9671dc75919dcc08a21f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaed3ff8d20a3a9671dc75919dcc08a21f">&#9670;&nbsp;</a></span>rwbarr</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define rwbarr</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td>&#160;&#160;&#160;do{}while(0)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Explicit read/write memory barrier Prevents reordering of reads or writes around it. </p>

<p class="definition">Definition at line <a class="el" href="epics_m_m_i_o_def_8h_source.html#l00202">202</a> of file <a class="el" href="epics_m_m_i_o_def_8h_source.html">epicsMMIODef.h</a>.</p>

</div>
</div>
<a id="ga18dc5c35a3413bd02ca26bc181a45141"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga18dc5c35a3413bd02ca26bc181a45141">&#9670;&nbsp;</a></span>wbarr</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define wbarr</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td>&#160;&#160;&#160;do{}while(0)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Explicit write memory barrier Prevents reordering of writes around it. </p>

<p class="definition">Definition at line <a class="el" href="epics_m_m_i_o_def_8h_source.html#l00198">198</a> of file <a class="el" href="epics_m_m_i_o_def_8h_source.html">epicsMMIODef.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga7a98b2fb893898ff2591d3192358f261"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7a98b2fb893898ff2591d3192358f261">&#9670;&nbsp;</a></span>bswap16()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INLINE epicsUInt16 bswap16 </td>
          <td>(</td>
          <td class="paramtype">epicsUInt16&#160;</td>
          <td class="paramname"><em>value</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="epics_m_m_i_o_def_8h_source.html#l00094">94</a> of file <a class="el" href="epics_m_m_i_o_def_8h_source.html">epicsMMIODef.h</a>.</p>

</div>
</div>
<a id="ga6c439c03ce1627a9b7347732c9fa1c89"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6c439c03ce1627a9b7347732c9fa1c89">&#9670;&nbsp;</a></span>ioread8()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INLINE epicsUInt8 ioread8 </td>
          <td>(</td>
          <td class="paramtype">volatile void *&#160;</td>
          <td class="paramname"><em>addr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read a single byte. </p>

<p class="definition">Definition at line <a class="el" href="epics_m_m_i_o_def_8h_source.html#l00032">32</a> of file <a class="el" href="epics_m_m_i_o_def_8h_source.html">epicsMMIODef.h</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
