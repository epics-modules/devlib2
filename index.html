<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>devLib2: devLib2 MMIO Bus Access Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">devLib2
   &#160;<span id="projectnumber">2.11</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">devLib2 MMIO Bus Access Library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="whatisit"></a>
What is it?</h1>
<p>devLib2 is an extension to the EPICS OS independent VME bus access library found in the EPICS Base. The <a class="el" href="group__mmio.html">MMIO API</a> is included in EPICS Base &gt;=3.15.0.2</p>
<h1><a class="anchor" id="whereis"></a>
Source</h1>
<p>Releases can be found at  <a href="http://sourceforge.net/projects/epics/files/devlib2/">http://sourceforge.net/projects/epics/files/devlib2/</a></p>
<p>VCS source browser  <a href="https://github.com/epics-modules/devlib2">https://github.com/epics-modules/devlib2</a></p>
<p>Or checked out with</p>
<p>git clone <a href="https://github.com/epics-modules/devlib2.git">https://github.com/epics-modules/devlib2.git</a></p>
<p>The canonical version of this page is  <a href="http://epics.sourceforge.net/devlib2/">http://epics.sourceforge.net/devlib2/</a></p>
<h2><a class="anchor" id="requires"></a>
Requires</h2>
<p>EPICS Base &gt;= 3.14.8.2</p>
<p><a href="http://www.aps.anl.gov/epics/">http://www.aps.anl.gov/epics/</a></p>
<h1><a class="anchor" id="features"></a>
Features</h1>
<p>devLib2 adds features in several areas: PCI bus access, VME64x CSR/CSR, and memory mapped I/O (MMIO) operations.</p>
<h2><a class="anchor" id="pcisec"></a>
PCI Bus</h2>
<p>The PCI bus access interface is entirely new. It is currently implemented for RTEMS, vxWorks, and Linux (with <a class="el" href="pcilinux.html">some limitations</a>). The PCI interface provides functions for: searching the bus, mapping devices into process memory, and (dis)connecting interrupts.</p>
<p>Runtime selection of implementations is also supported. This allows code using this interface to compile and link for all target, even those which lack an implementation.</p>
<ul>
<li><a class="el" href="group__pci.html">API Documentation</a></li>
</ul>
<ul>
<li><a class="el" href="pciusage.html">PCI Usage</a></li>
</ul>
<ul>
<li><a class="el" href="exploreapp.html">PCI driver/hardware development tool</a></li>
</ul>
<ul>
<li><a class="el" href="iocsh.html#iocshpci">IOCsh functions for PCI devices</a></li>
</ul>
<h3><a class="anchor" id="explorepci"></a>
Generic PCI driver</h3>
<p>The exploreApp <a class="el" href="exploreapp.html">PCI driver/hardware development tool</a> is a generic EPICS driver intended to support development of custom PCI/PCIe devices. It provides a set of records which read/write to individual registers. Basic support for interrupts is also available (Linux only).</p>
<h2><a class="anchor" id="vmesec"></a>
VME CSR</h2>
<p>The VME64x library provides several functions for accessing the CSR/CR address space defined by VME64 and extended by VME64x. This includes: probing by slot number and matching by identifier registers, definitions of standard registers, and functions to access them.</p>
<ul>
<li><a class="el" href="group__vmecsr.html">API Docmentation</a></li>
</ul>
<ul>
<li><a class="el" href="vmeusage.html">VME64 CSR Usage</a></li>
</ul>
<ul>
<li><a class="el" href="group__vmecsrregs.html">CSR/CR Register Definitions</a></li>
</ul>
<ul>
<li><a class="el" href="iocsh.html#iocshvme">IOCsh functions for VME devices</a></li>
</ul>
<h2><a class="anchor" id="mmiosec"></a>
MMIO</h2>
<p>The MMIO library provides an OS and CPU architecture independent way to safely access memory mapped I/O devices. Makes guarantees of the width and order of accesses.</p>
<ul>
<li><a class="el" href="group__mmio.html">API Docmentation</a></li>
</ul>
<h1><a class="anchor" id="changelog"></a>
Changelog</h1>
<h2><a class="anchor" id="ver2c"></a>
2.12 (UNRELEASED)</h2>
<ul>
<li>Various fixes for Linux, and preparation for Windows support (Dirk Zimoch) </li>
<li>Fix redirection of iocsh functions</li>
</ul>
<h2><a class="anchor" id="ver2b"></a>
2.11 (Apr 2020)</h2>
<ul>
<li>Set SHRLIB_VERSION </li>
<li>Fix handling of PCI mmap() on Linux (Dirk Zimoch)</li>
</ul>
<h2><a class="anchor" id="ver2a"></a>
2.10 (Nov 2018)</h2>
<ul>
<li>Support Base 7.0.x </li>
<li>Publish module version to user makefiles </li>
<li>Minor bug fixes</li>
</ul>
<h2><a class="anchor" id="ver29"></a>
2.9 (July 2017)</h2>
<ul>
<li>pci: change <a class="el" href="group__pci.html#ga60923b7ae6adf7809f96492a406f3b60" title="PCI bus search by specification string. ">devPCIFindSpec()</a> to parse B:D.F as hex. This is an incompatible change! </li>
<li>pci: Fixups for vxWorks 5 (Dirk Zimoch) </li>
<li>pci: Add missing offset bounds check to PCI iocsh functions </li>
<li>vme: Various fixes for VME iocsh functions </li>
<li>explore: Add exploreApp toolkit for PCI driver/hardware development (<a class="el" href="exploreapp.html">PCI driver/hardware development tool</a>) </li>
<li>linux: Add pci_generic_msi.c UIO driver to support devices with single vector MSI</li>
</ul>
<h2><a class="anchor" id="ver28"></a>
2.8 (Sept. 2016)</h2>
<ul>
<li>Fixes an bug with <a class="el" href="epics_m_m_i_o_8h.html">epicsMMIO.h</a> for some targets where a single read macro expands to either 2 (16 bit) or 4 (32 bit) loads in situations where a byte swap is necessary. Effects all targets except RTEMS on powerpc to some degree. On Linux be_*() or le_*() are effected (depending on target byte order). On vxWorks nat_*() and le_* are effected on big endian targets, and le_*() on little endian targets. </li>
<li>pci: Bump API version to 1.3 </li>
<li>pci: Add PCI ID match macro <a class="el" href="group__pci.html#ga3e3017063b52316c7ae6ad9995ffdd54">DEVPCI_DEVICE_ANY()</a> </li>
<li>pci: Add member <a class="el" href="structepics_p_c_i_device.html#a5bd61396ce4af38e624f702bd2ddc3dd">epicsPCIDevice::slot</a> and macro DEVPCI_NO_SLOT </li>
<li>pci/linux: Look at /sys/bus/pci/slots/*/address to populate slot member. </li>
<li>pci: Add function <a class="el" href="group__pci.html#ga60923b7ae6adf7809f96492a406f3b60" title="PCI bus search by specification string. ">devPCIFindSpec()</a> to search by text string. Understands PCI bus address, slot number, and/or instance number </li>
<li>Add <a class="el" href="group__pci.html#gacc767f07f70acc51a3d67b6de3855b2a">devPCIShowMatch()</a> variant of <a class="el" href="group__pci.html#ga1fe729e716ec1cb1a709c05f59c3c879">devPCIShow()</a> using <a class="el" href="group__pci.html#ga60923b7ae6adf7809f96492a406f3b60" title="PCI bus search by specification string. ">devPCIFindSpec()</a>.</li>
</ul>
<h2><a class="anchor" id="ver27"></a>
2.7 (Jan. 2016)</h2>
<ul>
<li>configure: optionally include $(TOP)/configure/RELEASE.local and $(TOP)/../RELEASE.local. $(EPICS_BASE) is no longer defined by default in configure/RELEASE and must be explicitly set in one of the possible RELEASE* files. </li>
<li>Fix compile failure on vxWorks (Eric Bjorklund) </li>
<li>Add missing extern "C" in <a class="el" href="epics_m_m_i_o_8h.html">epicsMMIO.h</a> for vxWorks (Eric Bjorklund) </li>
<li>In <a class="el" href="epics_m_m_i_o_def_8h.html">epicsMMIODef.h</a> replace 'inline' with 'static inline' for C compatibility. </li>
<li>RTEMS: handle BSPs with offset PCI addresses </li>
<li>pci/linux: devPCIDebug&gt;1 enables more debug output when searching/matching PCI devices. </li>
<li>pci/linux: fix error preventing use of uio devices other than uio0. </li>
<li>vme: add <a class="el" href="vmesh_8c.html#a37abe130546ba8fe6d14fd18c8e5d2ce">vmewrite()</a>, <a class="el" href="vmesh_8c.html#ab04439cdeea1c4a3c25fd520cf28ddf6">vmeirqattach()</a>, and <a class="el" href="vmesh_8c.html#a14e7e811c907bcccc6a51e530a3467ee">vmeirq()</a> iocsh commands for debugging/development with VME devices.</li>
</ul>
<h2><a class="anchor" id="ver26"></a>
2.6 (May 2015)</h2>
<ul>
<li>VCS repository moved to github.com </li>
<li>Increment API version to 1.2 (was 1.0) </li>
<li><a class="el" href="epics_m_m_i_o_8h.html">epicsMMIO.h</a> included in EPICS Base 3.15.1, not installed by this module.</li>
</ul>
<p>Work by Andrew Johnson</p>
<ul>
<li>Import support for vxWorks 5.5 on m68k and powerpc from EPICS Base.</li>
</ul>
<p>Work by Till Straumann</p>
<ul>
<li>Add PCI Config space access functions devPCIConfigRead##() and devPCIConfigWrite##() </li>
<li>Add <a class="el" href="group__pci.html#ga87235fe2b2675efbdaf93a9c07a9eb51" title="Enable interrupts at the device. ">devPCIEnableInterrupt()</a> and <a class="el" href="group__pci.html#gaccfcb3e128815950b0eadff95f57f6e1" title="Enable interrupts at the device. ">devPCIDisableInterrupt()</a>.<ul>
<li>Linux: invoke the UIO irqcontrol callback function with a 1 or 0.</li>
<li>vxWorks: call intEnable or intDisable (enabled by default). (Dirk Zimoch)</li>
</ul>
</li>
</ul>
<p>Work by Dirk Zimoch</p>
<ul>
<li>Rework of the Linux PCI bus scan to support PCI domains. Previously domain 0 was used implicitly. </li>
<li>Rework of the vxWorks/RTEMS PCI bus scan to allow wildcards in device search. This allows devPCIShow for all PCI devices like in Linux. </li>
<li>Fixes for 64 bit BARs. </li>
<li>vxWorks: use BAR address directly if sysBusToLocalAdrs does not support PCI. </li>
<li>Changes in devPCIShow to get nicer output.</li>
</ul>
<p>Work by Michael Davidsaver</p>
<ul>
<li>Add the <a class="el" href="pcish_8c.html#a1a4e59efc7d75d6c68bd3ed11e11c26b">pciconfread()</a> iocsh function. </li>
<li><a class="el" href="dev_lib_p_c_i_impl_8h.html#a16529ef143d851213e00804bae55a9c7">devLibPCIRegisterDriver()</a> is now a macro wrapping <a class="el" href="dev_lib_p_c_i_8c.html#aa2daff1558ed14a260dcc576ccd0e08a">devLibPCIRegisterDriver2()</a> which performs a consistency check on the size of the <a class="el" href="structdev_lib_p_c_i.html">devLibPCI</a> structure. </li>
<li>provide <a class="el" href="group__mmio.html#ga7a98b2fb893898ff2591d3192358f261">bswap16()</a> and <a class="el" href="epics_m_m_i_o_def_8h.html#ad3a13570a978557df80007dee3eaddfd">bswap32()</a> for RTEMS PPC targets. Previously omitted. </li>
<li>Change name format of Linux user "ISR" thread to include PCI BDF.</li>
</ul>
<h2><a class="anchor" id="ver25"></a>
2.5 (May 2014)</h2>
<ul>
<li>Linux: possible string corruption in vallocPrintf() Found by Till Straumann </li>
<li>vxWorks: lookup symbols including sysBusToLocalAdrs at runtime. Work by Eric and Dirk Zimoch </li>
<li>RTEMS: Select no-op MMIO implementation for m68k (no special handling required)</li>
</ul>
<h2><a class="anchor" id="ver24"></a>
2.4 (Oct. 2012)</h2>
<ul>
<li>Remove C++ style comments from <a class="el" href="epics_m_m_i_o_def_8h.html">epicsMMIODef.h</a> and <a class="el" href="devcsr_8h.html">devcsr.h</a> </li>
<li>Fix Issue preventing Custom PCI bus implementation. (Found by Dan Eichel) </li>
<li>Linux "ISR" thread stack size not correct (Fixed by Till Straumann) </li>
<li>Linux: Previous versions expected Linux kernel modules to leave gaps for un-mappable PCI BARs (I/O Ports). However, most existing kernel modules don't do this. Add a flag to <a class="el" href="group__pci.html#gad7c075a2769f5e93cb9f4d567346c7f1" title="Get pointer to PCI BAR. ">devPCIToLocalAddr()</a> to specify how a device's kernel module does mapping. The default is to map as in previous versions. (New behavior by Till Straumann) See documentation of <a class="el" href="group__pci.html#gad7c075a2769f5e93cb9f4d567346c7f1" title="Get pointer to PCI BAR. ">devPCIToLocalAddr()</a>.</li>
</ul>
<h2><a class="anchor" id="ver23"></a>
2.3 (Apr. 2012)</h2>
<ul>
<li>Include proper headers to enable memory barriers for vxWorks &gt;= 6.6 </li>
<li>Fallback to noop when vxWorks memory barriers are not available </li>
<li>Fix incorrect return code when connecting pci interrupts on vxWorks</li>
</ul>
<h2><a class="anchor" id="ver22"></a>
2.2 (Sept. 2011)</h2>
<ul>
<li>linux: follow changes to /sys (needed for kernel &gt;2.6.26) </li>
<li>pci: IOC shell functions added: <a class="el" href="pcish_8c.html#aee1ae721a9daf586a584b27e2ce52ef2">pciread()</a> </li>
<li>pci: vxworks translate PCI addresses </li>
<li>Build on vxWorks 6.8 (Thanks to Andrew Johnson) </li>
<li>pci: Make operations reentrant on RTEMS and vxWorks (previously was not oops.) </li>
<li>pci: Fix bug with devPCIBarLen on RTEMS and vxWorks.</li>
</ul>
<h2><a class="anchor" id="ver21"></a>
2.1 (Jan. 2011)</h2>
<ul>
<li>Fix build issue with 3.14.12 with RTEMS pc386 (found by Jim Chen from Hytec) </li>
<li>Add notification of missed PCI interrupt events on Linux </li>
<li>Additional arguement 'count' for <a class="el" href="vmesh_8c.html#aa6f72337db8d64896338de351821b8d0">vmeread()</a> to show blocks of registers </li>
<li>Add section to PCI Usage on x86 Port I/O </li>
<li>Add section to PCI Access in Linux concerning hardware requirements</li>
</ul>
<h2><a class="anchor" id="ver20"></a>
2.0 (Sept. 2010)</h2>
<ul>
<li>Initial release.</li>
</ul>
<dl class="section author"><dt>Author</dt><dd>Michael Davidsaver <a href="#" onclick="location.href='mai'+'lto:'+'mda'+'vi'+'dsa'+'ve'+'r@g'+'ma'+'il.'+'co'+'m'; return false;">mdavi<span style="display: none;">.nosp@m.</span>dsav<span style="display: none;">.nosp@m.</span>er@gm<span style="display: none;">.nosp@m.</span>ail.<span style="display: none;">.nosp@m.</span>com</a> </dd>
<dd>
Till Straumann <a href="#" onclick="location.href='mai'+'lto:'+'str'+'au'+'man'+'@s'+'lac'+'.s'+'tan'+'fo'+'rd.'+'ed'+'u'; return false;">strau<span style="display: none;">.nosp@m.</span>man@<span style="display: none;">.nosp@m.</span>slac.<span style="display: none;">.nosp@m.</span>stan<span style="display: none;">.nosp@m.</span>ford.<span style="display: none;">.nosp@m.</span>edu</a> </dd>
<dd>
Dirk Zimoch <a href="#" onclick="location.href='mai'+'lto:'+'dir'+'k.'+'zim'+'oc'+'h@p'+'si'+'.ch'; return false;">dirk.<span style="display: none;">.nosp@m.</span>zimo<span style="display: none;">.nosp@m.</span>ch@ps<span style="display: none;">.nosp@m.</span>i.ch</a> </dd></dl>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
