<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>devLib2: PCI driver/hardware development tool</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">devLib2
   &#160;<span id="projectnumber">2.11</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">PCI driver/hardware development tool </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="exploreintro"></a>
Purpose</h1>
<p>The exploreApp support is intended as a tool to explore new PCI devices. This may be useful when preparing to write a dedicated driver and/or during development of PCI/PCIe device firmware. exploreApp allows a PCI register to be read and/or written an EPICS record. For example:</p>
<div class="fragment"><div class="line">record(longout, <span class="stringliteral">&quot;pcitestout&quot;</span>) {</div><div class="line">  field(DTYP, <span class="stringliteral">&quot;Explore Write32 LSB&quot;</span>)</div><div class="line">  field(OUT , &quot;@8:0.0 bar=0 offset=0xc&quot;)</div><div class="line">}</div></div><!-- fragment --><p>The record <b>pcitestout</b> will be connected to the PCI device 8:0.0 (bus 8, device 0, function 0) with the first BAR. A single write of 4 bytes is made when the record is processed.</p>
<p>The following can be added to some <b>xyzApp/src/Makefile</b> to include exploreApp.</p>
<div class="fragment"><div class="line">PROD_IOC += myioc</div><div class="line">DBD += myioc.dbd</div><div class="line">myioc_DBD += exploreSupport.dbd</div><div class="line">myioc_LIBS += explorepci epicspci</div></div><!-- fragment --><h1><a class="anchor" id="exploreopts"></a>
Options</h1>
<p><b>INP/OUT</b> link strings may contain the following components</p>
<ul>
<li>"bar=#" (default: 0) </li>
<li>"offset=#" in bytes (default: 0) </li>
<li>"mask=#" bit mask (default: 0 aka. no mask) </li>
<li>"shift=#" in bits (default: 0) </li>
<li>"step=#" in bytes (default: read size. eg Read32 defaults to step=4) </li>
<li>"initread=1|0" bool (default: 1 for .OUT recordtypes, 0 otherwise)</li>
</ul>
<p>For record types: <b>longout</b>, <b>bo</b>, <b>mbbo</b>, <b>mbboDirect</b>, <b>ao</b> allowed <b>DTYP</b> are:</p>
<ul>
<li>Explore Write8 </li>
<li>Explore Write16 NAT </li>
<li>Explore Write16 LSB </li>
<li>Explore Write16 MSB </li>
<li>Explore Write32 NAT </li>
<li>Explore Write32 LSB </li>
<li>Explore Write32 MSB</li>
</ul>
<p>For record types: <b>longin</b>, <b>longout</b>, <b>bi</b>, <b>bo</b>, <b>mbbi</b>, <b>mbbo</b>, <b>mbbiDirect</b>, <b>mbboDirect</b>, <b>ai</b>, <b>ao</b> </p>
<ul>
<li>Explore Read8 </li>
<li>Explore Read16 NAT </li>
<li>Explore Read16 LSB </li>
<li>Explore Read16 MSB </li>
<li>Explore Read32 NAT </li>
<li>Explore Read32 LSB </li>
<li>Explore Read32 MSB</li>
</ul>
<p>The <b>ao</b> record type also accepts</p>
<ul>
<li>Explore WriteF32 LSB </li>
<li>Explore WriteF32 MSB</li>
</ul>
<p>The <b>ai</b> record type also accepts</p>
<ul>
<li>Explore ReadF32 LSB </li>
<li>Explore ReadF32 MSB</li>
</ul>
<p>The <b>waveform</b> record type accepts both integer Read and Write <b>DTYP</b>. The <b>step=</b> link option may be applied to change how the address counter is incremented. The default step size is the read size (eg. 4 for Read32). A step size of 0 will read the base address <b>NELM</b> times.</p>
<h1><a class="anchor" id="exploreirq"></a>
PCI Interrupt</h1>
<p>Limited support of PCI interrupts is available on Linux only. A <b>longin</b> record with DTYP="Explore IRQ Count" and SCAN="I/O Intr" will be processed each time an interrupt occurs.</p>
<p>This requires that a UIO kernel module be installed.</p>
<h1><a class="anchor" id="explorefrib"></a>
FRIB Specific</h1>
<p>The DTYP="Explore FRIB Flash" support implements a FRIB specific protocol for accessing a SPI flash chip over PCI. The <b>frib-flash.db</b> file demonstrates use. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
